<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="jianjian">





<title>MongoDB基础操作 | imjianjian</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">imjianjian&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">imjianjian&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">MongoDB基础操作</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">jianjian</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">December 30, 2017&nbsp;&nbsp;15:50:30</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <b>
MongoDB版本：3.4
</b>

<h1 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h1><p>find()</p>
<h2 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123;&#125;)</span><br><span class="line">db.collection.find()</span><br></pre></td></tr></table></figure>
<h2 id="文档查询"><a href="#文档查询" class="headerlink" title="文档查询"></a>文档查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查询name=&quot;jianjian&quot;的所有文档</span><br><span class="line">db.collection.find(&#123;&quot;collection&quot;:&quot;jianjian&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="条件操作符"><a href="#条件操作符" class="headerlink" title="条件操作符"></a>条件操作符</h2><ul>
<li>$lt 小于</li>
<li>$gt 大于</li>
<li>$gte 大于等于</li>
<li>$lte 小于等于</li>
<li>$ne 不等于</li>
<li>$all 全包含</li>
<li>$in 包含</li>
<li>$nin 不包含</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查询年龄小于18的</span><br><span class="line">db.collection.find(&quot;age&quot;:&#123;$lt:&quot;18&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="all"><a href="#all" class="headerlink" title="$all"></a>$all</h2><p>必须满足所有值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//可以查询出来&#123;age:[20,21,22]&#125;但是查询不出来&#123;age:[20,22,23]&#125;，即一定要有20和21.</span><br><span class="line">db.collection.find(&#123;age:&#123;$all:[20,21]&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="in"><a href="#in" class="headerlink" title="$in"></a>$in</h2><p>这个与$all不一样，查询的值在$in给出的范围之内就都可以查出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//&#123;age:[20,21,22]&#125;,&#123;age:[20,22,23]&#125;都能查出来</span><br><span class="line">db.collection.find(&#123;age:&#123;$in:[20,21]&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="exists"><a href="#exists" class="headerlink" title="$exists"></a>$exists</h2><p>判断key是否存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">判断age字段是否存在</span><br><span class="line">db.collection.find(&#123;age:&#123;$exists:true&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="null值的处理"><a href="#null值的处理" class="headerlink" title="null值的处理"></a>null值的处理</h2><p>null值处理需要注意的是，不仅仅可以查询出来某一字段值为null的记录，还可以查出来不存在某一字段的记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123;age:null&#125;)</span><br></pre></td></tr></table></figure>
<p>可以查询出来age为null的记录，以及没有age字段的记录。如果我们需要只去查询存在age字段并且age字段的值为null的记录，需要配合exists操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123;age:&#123;&quot;$in&quot;:[null],&quot;$exists&quot;:true&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="限制查询条数"><a href="#限制查询条数" class="headerlink" title="限制查询条数"></a>限制查询条数</h2><p>limit(number)</p>
<p>number为条数 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查询条数限制为10条</span><br><span class="line">db.collection.find().limit(10)</span><br></pre></td></tr></table></figure>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>sort({key:1})</p>
<p>key为需要排序的字段，升序为1，降序为-1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//按照年龄升序排序</span><br><span class="line">db.collection.find().sort(&#123;&quot;age&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="跳过记录"><a href="#跳过记录" class="headerlink" title="跳过记录"></a>跳过记录</h2><p>skip()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询第10到20条的记录</span><br><span class="line">db.collection.find().skip(10).limit(10);</span><br></pre></td></tr></table></figure>

<h2 id="查询文档条数"><a href="#查询文档条数" class="headerlink" title="查询文档条数"></a>查询文档条数</h2><p>count()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">age大于25的条数</span><br><span class="line">db.collection.find(&#123;age: &#123;$gte: 25&#125;&#125;).count();</span><br></pre></td></tr></table></figure>
<h1 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h1><p>insert()基本语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(</span><br><span class="line">   &lt;document or array of documents&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="单条插入"><a href="#单条插入" class="headerlink" title="单条插入"></a>单条插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(&#123;&quot;name&quot;:&quot;jianjian&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="多条插入"><a href="#多条插入" class="headerlink" title="多条插入"></a>多条插入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert([&#123;&quot;name&quot;:&quot;jianjian&quot;&#125;,&#123;&quot;name&quot;:&quot;dongdong&quot;&#125;])</span><br></pre></td></tr></table></figure>
<h2 id="错误的语法"><a href="#错误的语法" class="headerlink" title="错误的语法"></a>错误的语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(&#123;&quot;age&quot;:11&#125;,&#123;&quot;age&quot;:12&#125;)</span><br></pre></td></tr></table></figure>
<p>只有age:11被插入进去，由于接收的插入文档不是数组</p>
<p>容易误导的地方:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert([&#123;&quot;name&quot;:&quot;jianjian&quot;&#125;,&#123;&quot;name&quot;:&quot;dongdong&quot;&#125;])</span><br><span class="line"></span><br><span class="line">db.collection.insert(&#123;&quot;name&quot;:&quot;jianjian&quot;&#125;,&#123;&quot;age&quot;:&quot;dongdong&quot;&#125;)</span><br><span class="line"></span><br><span class="line">db.collection.insert(&#123;&quot;name&quot;:&quot;jianjian&quot;,&quot;name&quot;:&quot;dongdong&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p>第一个插入是插入两个文档，第二个插入是插入一个文档,第三个虽然也是一个文档但是由于键重复，所以只有后一个值会被插入age:12</p>
<h1 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h1><p>remove() 方法的基本语法格式如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     justOne: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>query  :（可选）删除的文档的条件。</li>
<li>justOne  : （可选）如果设为 true 或 1，则只删除一个文档。</li>
<li>writeConcern  :（可选）抛出异常的级别。</li>
</ul>
<h2 id="删除num大于100的数据"><a href="#删除num大于100的数据" class="headerlink" title="删除num大于100的数据"></a>删除num大于100的数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.new.remove(&#123;&quot;num&quot;:&#123;$gt:100&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="删除new集合所有数据"><a href="#删除new集合所有数据" class="headerlink" title="删除new集合所有数据"></a>删除new集合所有数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.new.remove(&#123;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="删除num等于100的数据"><a href="#删除num等于100的数据" class="headerlink" title="删除num等于100的数据"></a>删除num等于100的数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.new.remove(&#123;&quot;num&quot;:100&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h1><p>update() 方法用于更新已存在的文档。语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>query  : update的查询条件，类似sql update查询内where后面的。</li>
<li>update  : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的<br>upsert  : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</li>
<li>multi  : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</li>
<li>writeConcern  :可选，抛出异常的级别。</li>
</ul>
<h2 id="set修改符"><a href="#set修改符" class="headerlink" title="$set修改符"></a>$set修改符</h2><p>用于修改键的值，如果键不存在就增加键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//将age=10的数据改成15，默认如果age=10的有多条记录只更新第一条</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;li&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:10&#125;&#125;)</span><br><span class="line"></span><br><span class="line">//更新多个满足条件的值,同时如果更新的值不存在就插入更新的值，注意：这里插入的值是20不是30</span><br><span class="line">db.collection.update(&#123;&quot;age&quot;:30&#125;,&#123;$set:&#123;&quot;age&quot;:20&#125;&#125;,&#123;multi:true,upsert:true&#125;)</span><br><span class="line"></span><br><span class="line">可以省略multi,upsert，这里不能有花括号，但是不建议这样做</span><br><span class="line">db.collection.update(&#123;&quot;age&quot;:30&#125;,&#123;$set:&#123;&quot;age&quot;:20&#125;&#125;,true,true)</span><br><span class="line"></span><br><span class="line">//值更新为数组</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:[10,</span><br><span class="line">12,14]&#125;&#125;,&#123;upsert:true&#125;)</span><br><span class="line"></span><br><span class="line">//修改为其它的值</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:&apos;&apos;&#125;&#125;,&#123;upsert:true&#125;)</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:null&#125;&#125;,&#123;upsert:true&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="inc修改符"><a href="#inc修改符" class="headerlink" title="$inc修改符"></a>$inc修改符</h2><p>用于增加已有键的值，如果键不存在就创建，只能用于整形、长整型、浮点型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//将name=zhang的记录的age键+10</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$inc:&#123;&quot;age&quot;:10&#125;&#125;,&#123;upsert:true&#125;)</span><br><span class="line"></span><br><span class="line">//将name=zhang的记录的age键-10</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$inc:&#123;&quot;age&quot;:-10&#125;&#125;,&#123;upsert:true&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="unset修改符"><a href="#unset修改符" class="headerlink" title="$unset修改符"></a>$unset修改符</h2><p>删除键类似关系数据库的删除字段操作，要区别$set修改符的将键设空或者null值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$unset:&#123;&quot;age&quot;:1&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="push修改符"><a href="#push修改符" class="headerlink" title="$push修改符"></a>$push修改符</h2><p>如果数组已经存在，“$push”会向已有的数组末尾加入一个元素，要是没有就创建一个新的数组。注意：必须是数组才能加入新的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$push:&#123;&quot;comments&quot;:&#123;&quot;email&quot;:&quot;abc@qq.com&quot;,&quot;address&quot;:&quot;beijing&quot;&#125;&#125;&#125;);</span><br><span class="line"></span><br><span class="line">//再插入一条comments</span><br><span class="line">db.collection.update(&#123;&quot;name&quot;:&quot;zhang&quot;&#125;,&#123;$push:&#123;&quot;comments&quot;:&#123;&quot;mark&quot;:&quot;aaa&quot;&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="each修改符"><a href="#each修改符" class="headerlink" title="$each修改符"></a>$each修改符</h2><p>向数组中添加元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(&#123;&quot;title&quot;:1,&quot;list&quot;:[1,2,3]&#125;)</span><br><span class="line"></span><br><span class="line">//向list数组中添加单个元素</span><br><span class="line">db.collection.update(&#123;&quot;title&quot;:1&#125;,&#123;$push:&#123;&quot;list&quot;:4&#125;&#125;)</span><br><span class="line"></span><br><span class="line">//向list数组中添加多个元素</span><br><span class="line">db.collection.update(&#123;&quot;title&quot;:1&#125;,&#123;$push:&#123;&quot;list&quot;:&#123;$each:[6,7]&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="addToSet修改符"><a href="#addToSet修改符" class="headerlink" title="$addToSet修改符"></a>$addToSet修改符</h2><p>往数组集中插入元素时，如果元素存在就不插入；方法和$push一样，唯一的区别就是$push不会判断重复值，重复也可以插入。$addToSet也可以结合$each一起使用方法和$push一样可以同时往数组中插入多个元素并且如果元素存在则不插入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(&#123;&quot;title&quot;:1&#125;,&#123;$addToSet:&#123;&quot;list&quot;:2&#125;&#125;)</span><br><span class="line"></span><br><span class="line">db.collection.update(&#123;&quot;title&quot;:1&#125;,&#123;$addToSet:&#123;&quot;list&quot;:&#123;$each:[2,3,4]&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="pull修改符"><a href="#pull修改符" class="headerlink" title="$pull修改符"></a>$pull修改符</h2><p>匹配数组中的元素将匹配上的元素全部删除，注意只能对数组中的元素进行匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(&#123;&quot;title&quot;:1,&quot;list&quot;:[1,2,3]&#125;);</span><br><span class="line"></span><br><span class="line">//清除list数组中的元素2</span><br><span class="line">db.collection.update(&#123;&#125;,&#123;$pull:&#123;&quot;list&quot;:2&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="pop修改符"><a href="#pop修改符" class="headerlink" title="$pop修改符"></a>$pop修改符</h2><p>从数组的末端或头删除一个元素，$pop:{“list”:1}：从末尾删除一个元素；$pop:{“list”:-1}:从开头删除一个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//向数组list中插入两个元素</span><br><span class="line">db.collection.update(&#123;&#125;,&#123;$push:&#123;&quot;list&quot;:&#123;$each:[2,4]&#125;&#125;&#125;);</span><br><span class="line"></span><br><span class="line">//从末尾删除元素</span><br><span class="line">db.collection.update(&#123;&#125;,&#123;$pop:&#123;&quot;list&quot;:1&#125;&#125;);</span><br><span class="line"></span><br><span class="line">//从开头删除元素</span><br><span class="line">db.collection.update(&#123;&#125;,&#123;$pop:&#123;&quot;list&quot;:-1&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>基于位置的数组修改方法<br>可以有两种方式来定位数组中的元素：</p>
<p>1.通过下标；数组的下标都是从0开始。</p>
<p>2.通过$定位操作符，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.insert(&#123;&quot;title&quot;:1,&quot;comments&quot;:[&#123;&quot;comment&quot;:&quot;a&quot;,&quot;author&quot;:&quot;chen&quot;,&quot;age&quot;:10&#125;,&#123;&quot;comment&quot;:&quot;b&quot;,&quot;author&quot;:&quot;wang&quot;,&quot;age&quot;:30&#125;,&#123;&quot;comment&quot;:&quot;c&quot;,&quot;author&quot;:&quot;zhang&quot;,&quot;age&quot;:40&#125;]&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//将数组中的第一个列表的age值改成20</span><br><span class="line">//方法1：</span><br><span class="line">db.comment.update(&#123;&#125;,&#123;$set:&#123;&quot;comments.0.age&quot;:20&#125;&#125;);</span><br><span class="line"></span><br><span class="line">//方法2：</span><br><span class="line">db.comment.update(&#123;&quot;comments.author&quot;:&quot;chen&quot;&#125;,&#123;$set:&#123;&quot;comments.$.age&quot;:20&#125;&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。</p>
<p>这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。</p>
<p>索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构</p>
<h2 id="ensureIndex-方法"><a href="#ensureIndex-方法" class="headerlink" title="ensureIndex() 方法"></a>ensureIndex() 方法</h2><p>MongoDB使用 ensureIndex() 方法来创建索引。</p>
<p>设置No为索引：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.collection.ensureIndex(&#123;&quot;No&quot;:1&#125;)</span><br><span class="line">1为指定按升序创建索引，如果你想按降序来创建索引指定为-1即可。</span><br></pre></td></tr></table></figure>
<h1 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h1><p>删除test集合,注意drop后面的括号里面不需要带花括号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.drop()</span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>jianjian</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://yoursite.com/2017/12/30/MongoDB%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/">http://yoursite.com/2017/12/30/MongoDB%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/MongoDB/"># MongoDB</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();" target="_blank" rel="noopener">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2018/01/02/MongoDB%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">MongoDB备份与恢复</a>
            
            
            <a class="next" rel="next" href="/2017/12/30/MongoDB%20%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">MongoDB安装与配置</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© jianjian | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
