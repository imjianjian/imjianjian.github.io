<!DOCTYPE html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=author content=jianjian><title>小程序开发遇坑集 | imjianjian</title><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/style.css><script src=/js/script.js></script><script src=/js/tocbot.min.js></script></head><body><div class=wrapper><header><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href="/">imjianjian&#39;s Blog</a></div><div class="menu navbar-right"><a class=menu-item href=/archives>Posts</a> <a class=menu-item href=/tags>Tags</a> <input id=switch_default type=checkbox class=switch_default><label for=switch_default class=toggleBtn></label></div></div></nav><nav class=navbar-mobile id=nav-mobile><div class=container><div class=navbar-header><div><a href="/">imjianjian&#39;s Blog</a><a id=mobile-toggle-theme>·&nbsp;Light</a></div><div class=menu-toggle onclick=mobileBtn()>&#9776; Menu</div></div><div class=menu id=mobile-menu><a class=menu-item href=/archives>Posts</a> <a class=menu-item href=/tags>Tags</a></div></div></nav></header><script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script><div class=main><div class=container><div class=post-toc><div class=tocbot-list></div><div class=tocbot-list-menu><a class=tocbot-toc-expand onclick=expand_toc()>Expand all</a> <a onclick=go_top()>Back to top</a> <a onclick=go_bottom()>Go to bottom</a></div></div><script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script><article class=post-wrap><header class=post-header><h1 class=post-title>小程序开发遇坑集</h1><div class=post-meta>Author: <a itemprop=author rel=author href="/">jianjian</a> <span class=post-time>Date: <a href=#>August 24, 2017&nbsp;&nbsp;16:11:00</a></span></div></header><div class=post-content><h1 id=1-wx-request中的数据加载到页面><a href=#1-wx-request中的数据加载到页面 class=headerlink title=1.wx.request中的数据加载到页面></a>1.wx.request中的数据加载到页面</h1><p>错误方式：</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>var that = this;</span><br><span class=line>      wx.request(&#123;</span><br><span class=line>        url:app.globalData.url.api.home,</span><br><span class=line>        success: function(res) &#123;</span><br><span class=line>            var a= res;</span><br><span class=line>            //这样直接赋值并不会把数据渲染到页面上的    不过 0.9版本的时候这样做是可以的   </span><br><span class=line>            that.data.a=a;</span><br><span class=line>        &#125;&#125;);</span><br></pre></td></tr></table></figure><p>正确方式：</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>that.setData(&#123;a:a;&#125;);</span><br></pre></td></tr></table></figure><h1 id=2-data-XX-数据存取><a href=#2-data-XX-数据存取 class=headerlink title="2.data-XX 数据存取"></a>2.data-XX 数据存取</h1><p>官方文档中的错误示范(个人觉得)：</p><p><img src=http://upload-images.jianshu.io/upload_images/3132358-f0029e7b83c7f96e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt=Paste_Image.png></p><p>正确方式 ：<br>正确的dataset的值是放在currentTarget中的，用targer时常会取不到值<br>应该这样：event.currentTarget.dataset来获取dataset</p><h1 id=3-小程序post写法><a href=#3-小程序post写法 class=headerlink title=3.小程序post写法></a>3.小程序post写法</h1><h2 id=这点在小程序文档中没有解释清楚><a href=#这点在小程序文档中没有解释清楚 class=headerlink title=这点在小程序文档中没有解释清楚></a>这点在小程序文档中没有解释清楚</h2><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line>wx.request(&#123;</span><br><span class=line>    url: app.globalData.server + &apos;/cart/list.do&apos;,</span><br><span class=line>    header: &#123; &quot;content-type&quot;: &quot;application/x-www-form-urlencoded&quot; &#125;,</span><br><span class=line>    method: &quot;POST&quot;,</span><br><span class=line>    data: Util.json2Form(&#123; cartId: app.globalData.cartId&#125;),</span><br><span class=line>    success:function()&#123;&#125;</span><br><span class=line>&#125;)</span><br></pre></td></tr></table></figure><h2 id=json2Form方法><a href=#json2Form方法 class=headerlink title=json2Form方法></a>json2Form方法</h2><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line>function json2Form(json) &#123;</span><br><span class=line>    var str = [];</span><br><span class=line>    for (var p in json) &#123;</span><br><span class=line>        str.push(encodeURIComponent(p) + &quot;=&quot; + encodeURIComponent(json[p]));</span><br><span class=line>    &#125;</span><br><span class=line>    return str.join(&quot;&amp;&quot;);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure></div><section class=post-copyright><p class=copyright-item><span>Author:</span> <span>jianjian</span></p><p class=copyright-item><span>Permalink:</span> <span><a href="http://yoursite.com/2017/08/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E4%B8%AD%E9%81%87%E5%9D%91%E9%9B%86/">http://yoursite.com/2017/08/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E4%B8%AD%E9%81%87%E5%9D%91%E9%9B%86/</a></span></p><p class=copyright-item><span>License:</span> <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target=_blank rel=noopener>CC-BY-NC-4.0</a> LICENSE</span></p><p class=copyright-item><span>Slogan:</span> <span>Do you believe in <strong>DESTINY<strong>?</strong></strong></span></p></section><section class=post-tags><div><span>Tag(s):</span> <span class=tag><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"># 微信小程序</a></span></div><div><a href=javascript:window.history.back(); target=_blank rel=noopener>back</a> <span>·</span> <a href="/">home</a></div></section><section class=post-nav><a class=prev rel=prev href="/2017/08/25/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8C%89%E9%92%AE%E6%BB%91%E5%8A%A8%E6%A1%88%E4%BE%8B/">小程序按钮滑动案例</a> <a class=next rel=next href="/2017/02/26/JavaScript%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F/">JavaScript模块模式</a></section></article></div></div><footer id=footer class=footer><div class=copyright><span>© jianjian | Powered by <a href=https://hexo.io target=_blank>Hexo</a> & <a href=https://github.com/Siricee/hexo-theme-Chic target=_blank>Chic</a></span></div></footer></div></body></html>